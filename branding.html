<div class="p-8">
    <h2 class="text-3xl font-bold text-gray-900 mb-6">Rebranding & Customization</h2>

    <div class="flex border-b border-gray-200 mb-8 space-x-6">
        <span class="branding-tab py-2 px-0 cursor-pointer font-bold text-gray-500 transition-colors duration-300 hover:text-gray-800 border-b-2 border-transparent text-[#EA3A26] border-[#EA3A26]" data-tab="general">General Branding</span>
        <span class="branding-tab py-2 px-0 cursor-pointer font-bold text-gray-500 transition-colors duration-300 hover:text-gray-800 border-b-2 border-transparent" data-tab="domain">Custom Domain</span>
        <span class="branding-tab py-2 px-0 cursor-pointer font-bold text-gray-500 transition-colors duration-300 hover:text-gray-800 border-b-2 border-transparent" data-tab="email">Email Templates</span>
        <span class="branding-tab py-2 px-0 cursor-pointer font-bold text-gray-500 transition-colors duration-300 hover:text-gray-800 border-b-2 border-transparent" data-tab="portal">Customer Portal</span>
        <span class="branding-tab py-2 px-0 cursor-pointer font-bold text-gray-500 transition-colors duration-300 hover:text-gray-800 border-b-2 border-transparent" data-tab="preview">Live Preview</span>
    </div>

    <div id="branding-tab-general" class="branding-content-view">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">General Branding Settings</h3>
        <div class="bg-white p-6 rounded-lg shadow-md space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="logoUpload" class="block text-sm font-medium text-gray-700 mb-1">Company Logo:</label>
                    <input type="file" id="logoUpload" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-[#EA3A26] file:text-white hover:file:bg-[#F54F1D]"/>
                    <p class="text-xs text-gray-500 mt-1">Upload your primary logo (PNG, JPG, SVG recommended).</p>
                    <div class="mt-3 p-2 border border-gray-200 rounded-md bg-gray-50 flex items-center justify-center h-24">
                        <img id="logoPreview" src="https://via.placeholder.com/100x40/E0E0E0/6C757D?text=Logo+Preview" alt="Logo Preview" class="max-h-full max-w-full object-contain">
                    </div>
                </div>
                <div>
                    <label for="faviconUpload" class="block text-sm font-medium text-gray-700 mb-1">Favicon:</label>
                    <input type="file" id="faviconUpload" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-[#EA3A26] file:text-white hover:file:bg-[#F54F1D]"/>
                    <p class="text-xs text-gray-500 mt-1">Upload your favicon (e.g., .ico, PNG 32x32).</p>
                    <div class="mt-3 p-2 border border-gray-200 rounded-md bg-gray-50 flex items-center justify-center h-10 w-10">
                        <img id="faviconPreview" src="https://via.placeholder.com/32x32/E0E0E0/6C757D?text=Fav" alt="Favicon Preview" class="max-h-full max-w-full object-contain">
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="primaryColor" class="block text-sm font-medium text-gray-700 mb-1">Primary Brand Color:</label>
                    <input type="color" id="primaryColor" value="#EA3A26" class="w-full h-10 border border-gray-300 rounded-md cursor-pointer" onchange="updatePreviewColors()">
                    <p class="text-xs text-gray-500 mt-1">Used for main accents, buttons.</p>
                </div>
                <div>
                    <label for="secondaryColor" class="block text-sm font-medium text-gray-700 mb-1">Secondary Brand Color:</label>
                    <input type="color" id="secondaryColor" value="#FF8600" class="w-full h-10 border border-gray-300 rounded-md cursor-pointer" onchange="updatePreviewColors()">
                    <p class="text-xs text-gray-500 mt-1">Used for secondary elements, highlights.</p>
                </div>
            </div>
            <button onclick="saveBrandingSettings()" class="px-6 py-2 bg-green-600 text-white rounded-md font-semibold hover:bg-green-700 transition-colors duration-200">Save Changes</button>
        </div>
    </div>

    <div id="branding-tab-domain" class="branding-content-view hidden">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">Custom Domain & URL Masking (Conceptual)</h3>
        <div class="bg-white p-6 rounded-lg shadow-md space-y-6">
            <div>
                <label for="customDomain" class="block text-sm font-medium text-gray-700 mb-1">Your Custom Domain:</label>
                <input type="text" id="customDomain" placeholder="rentals.yourcompany.com"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#EA3A26] focus:border-[#EA3A26]">
                <p class="text-xs text-gray-500 mt-1">This allows your customers to access the platform via your own domain name, completely masking the RentPro URL.</p>
            </div>
            <div class="bg-blue-50 border border-blue-200 p-4 rounded-md text-sm text-blue-800">
                <h4 class="font-semibold mb-2">Setup Instructions:</h4>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>Create a CNAME record in your domain registrar (e.g., GoDaddy, Cloudflare) pointing <code>rentals.yourcompany.com</code> to <code>your-vendor-id.rentpro.com</code>.</li>
                    <li>Verify DNS settings within the platform.</li>
                    <li>Our system will automatically provision and manage SSL certificates for your custom domain.</li>
                </ul>
                <p class="mt-3"><strong>Status:</strong> <span class="font-bold text-gray-700" id="domainStatus">Not Configured</span> <button class="ml-2 text-blue-600 hover:underline" onclick="alert('Simulating domain verification process...')">Verify DNS</button></p>
            </div>
            <button onclick="saveBrandingSettings()" class="px-6 py-2 bg-green-600 text-white rounded-md font-semibold hover:bg-green-700 transition-colors duration-200">Save Changes</button>
        </div>
    </div>

    <div id="branding-tab-email" class="branding-content-view hidden">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">Email & Notification Branding</h3>
        <div class="bg-white p-6 rounded-lg shadow-md space-y-6">
            <div>
                <label for="senderName" class="block text-sm font-medium text-gray-700 mb-1">Sender Name (for customer emails):</label>
                <input type="text" id="senderName" placeholder="Your Company Rentals"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#EA3A26] focus:border-[#EA3A26]">
                <p class="text-xs text-gray-500 mt-1">This name will appear as the sender for all automated emails to your customers.</p>
            </div>
            <div>
                <label for="replyToEmail" class="block text-sm font-medium text-gray-700 mb-1">Reply-To Email Address:</label>
                <input type="email" id="replyToEmail" placeholder="support@yourcompany.com"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#EA3A26] focus:border-[#EA3A26]">
                <p class="text-xs text-gray-500 mt-1">Customer replies to automated emails will be sent to this address.</p>
            </div>
            <div class="bg-gray-50 p-4 rounded-md text-sm text-gray-700">
                <h4 class="font-semibold mb-2">Email Template Customization (Conceptual):</h4>
                <p>In a full system, you would have access to customize the content and layout of various automated emails (Booking Confirmations, Invoice Reminders, Driver ETA Notifications) using a visual editor or HTML templates. You could add your logo, specific messaging, and social media links directly into the email body.</p>
                <button class="mt-3 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700" onclick="alert('Simulating email template editor...')">Customize Templates</button>
            </div>
            <button onclick="saveBrandingSettings()" class="px-6 py-2 bg-green-600 text-white rounded-md font-semibold hover:bg-green-700 transition-colors duration-200">Save Changes</button>
        </div>
    </div>

    <div id="branding-tab-portal" class="branding-content-view hidden">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">Customer Portal Customization</h3>
        <div class="bg-white p-6 rounded-lg shadow-md space-y-6">
            <div>
                <label for="portalBannerText" class="block text-sm font-medium text-gray-700 mb-1">Welcome Banner Text:</label>
                <input type="text" id="portalBannerText" placeholder="Welcome to Your Company's Rental Portal!"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#EA3A26] focus:border-[#EA3A26]">
                <p class="text-xs text-gray-500 mt-1">A short welcome message displayed on your customer's portal dashboard.</p>
            </div>
            <div>
                <label for="customCss" class="block text-sm font-medium text-gray-700 mb-1">Custom CSS (Advanced):</label>
                <textarea id="customCss" rows="5" placeholder="/* Add your custom CSS rules here */"
                          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#EA3A26] focus:border-[#EA3A26] font-mono text-sm resize-y"></textarea>
                <p class="text-xs text-gray-500 mt-1">For advanced users to apply custom styling to your customer portal. Use with caution.</p>
            </div>
            <div>
                <label for="customJs" class="block text-sm font-medium text-gray-700 mb-1">Custom JavaScript (Advanced):</label>
                <textarea id="customJs" rows="5" placeholder="// Add your custom JavaScript here (e.g., for analytics tracking)"
                          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#EA3A26] focus:border-[#EA3A26] font-mono text-sm resize-y"></textarea>
                <p class="text-xs text-gray-500 mt-1">Inject custom JavaScript for tracking, live chat widgets, etc.</p>
            </div>
            <button onclick="saveBrandingSettings()" class="px-6 py-2 bg-green-600 text-white rounded-md font-semibold hover:bg-green-700 transition-colors duration-200">Save Changes</button>
        </div>
    </div>

    <div id="branding-tab-preview" class="branding-content-view hidden">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">Live Preview (Client-Side Simulation)</h3>
        <div class="bg-gray-100 p-6 rounded-lg shadow-inner border border-gray-200">
            <h4 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2 border-gray-300">Simulated Customer Portal View</h4>
            <div id="previewArea" class="bg-white p-6 rounded-md shadow-md" style="border: 1px dashed #ccc;">
                <div id="previewHeader" class="flex items-center pb-4 mb-4 border-b">
                    <img id="previewLogo" src="https://via.placeholder.com/80x30/E0E0E0/6C757D?text=Logo" alt="Preview Logo" class="h-8 mr-3">
                    <span id="previewSiteName" class="font-bold text-lg text-gray-800">Your Company Rentals</span>
                    <button class="ml-auto px-3 py-1 rounded-md text-sm text-white" id="previewButton">Dashboard</button>
                </div>
                <p id="previewBanner" class="text-lg font-semibold text-gray-700 mb-4">Welcome to Your Company's Rental Portal!</p>
                <div class="p-4 rounded-md text-sm" id="previewCard" style="background-color: var(--preview-primary-bg, #f0f0f0); color: var(--preview-primary-text, #333);">
                    This is a sample card reflecting your primary color choice.
                </div>
                <div class="mt-4 text-sm" style="color: var(--preview-secondary-text, #666);">
                    Footer content here.
                </div>
            </div>
            <p class="text-xs text-gray-600 mt-4 italic">
                Note: This live preview updates elements directly within this module. It does not apply changes to the main dashboard UI, nor does it persist after page reload. For full system-wide rebranding, a backend integration would be required.
            </p>
        </div>
    </div>

</div>

<script>
    // Ensure window.brandingSettings exists or initialize it with defaults
    if (typeof window.brandingSettings === 'undefined' || typeof window.brandingSettings !== 'object') {
        window.brandingSettings = {
            logoUrl: 'https://via.placeholder.com/100x40/E0E0E0/6C757D?text=Default+Logo',
            faviconUrl: 'https://via.placeholder.com/32x32/E0E0E0/6C757D?text=Fav',
            primaryColor: '#EA3A26',
            secondaryColor: '#FF8600',
            customDomain: '',
            senderName: '',
            replyToEmail: '',
            portalBannerText: '',
            customCss: '',
            customJs: ''
        };
    }

    let brandingSettings = window.brandingSettings;

    // Get elements
    const brandingTabs = document.querySelectorAll('.branding-tab');
    const brandingContentViews = document.querySelectorAll('.branding-content-view');

    // General Branding elements
    const logoUploadInput = document.getElementById('logoUpload');
    const logoPreviewImg = document.getElementById('logoPreview');
    const faviconUploadInput = document.getElementById('faviconUpload');
    const faviconPreviewImg = document.getElementById('faviconPreview');
    const primaryColorInput = document.getElementById('primaryColor');
    const secondaryColorInput = document.getElementById('secondaryColor');

    // Domain Setup elements
    const customDomainInput = document.getElementById('customDomain');
    const domainStatusSpan = document.getElementById('domainStatus');

    // Email Templates elements
    const senderNameInput = document.getElementById('senderName');
    const replyToEmailInput = document.getElementById('replyToEmail');

    // Customer Portal elements
    const portalBannerTextInput = document.getElementById('portalBannerText');
    const customCssInput = document.getElementById('customCss');
    const customJsInput = document.getElementById('customJs');

    // Live Preview elements
    const previewArea = document.getElementById('previewArea');
    const previewLogo = document.getElementById('previewLogo');
    const previewSiteName = document.getElementById('previewSiteName');
    const previewButton = document.getElementById('previewButton');
    const previewBanner = document.getElementById('previewBanner');
    const previewCard = document.getElementById('previewCard');

    // --- Modal Functions (reusing for consistency) ---
    function openModal(modalId) {
        document.getElementById(modalId).classList.remove('hidden');
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.add('hidden');
    }

    // --- Tab Switching ---
    function switchBrandingView(tabName) {
        brandingContentViews.forEach(view => view.classList.add('hidden'));
        document.getElementById(`branding-tab-${tabName}`).classList.remove('hidden');

        // Update active tab styling
        brandingTabs.forEach(tab => {
            tab.classList.remove('text-[#EA3A26]', 'border-[#EA3A26]');
            tab.classList.add('text-gray-500', 'border-transparent');
        });
        const activeTab = Array.from(brandingTabs).find(tab => tab.dataset.tab === tabName);
        if (activeTab) {
            activeTab.classList.add('text-[#EA3A26]', 'border-[#EA3A26]');
            activeTab.classList.remove('text-gray-500', 'border-transparent');
        }

        // Render specific content for active tab
        if (tabName === 'preview') {
            updateLivePreview();
        } else if (tabName === 'general') {
            // Re-render logo/favicon previews if files were selected
            if (brandingSettings.logoFile) {
                const reader = new FileReader();
                reader.onload = (e) => logoPreviewImg.src = e.target.result;
                reader.readAsDataURL(brandingSettings.logoFile);
            }
            if (brandingSettings.faviconFile) {
                const reader = new FileReader();
                reader.onload = (e) => faviconPreviewImg.src = e.target.result;
                reader.readAsDataURL(brandingSettings.faviconFile);
            }
        }
    }

    // --- File Preview Handlers (for Logo & Favicon) ---
    function handleFileUpload(event, imgElement, settingName) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                imgElement.src = e.target.result;
                // Store file reference for "saving" (actual save would involve backend upload)
                brandingSettings[settingName] = e.target.result; // Store data URL for demo persistence
                brandingSettings[settingName + 'File'] = file; // Store file object too if needed
            };
            reader.readAsDataURL(file);
        } else {
            imgElement.src = brandingSettings[settingName] || ''; // Revert to stored or default
        }
        updateLivePreview();
    }

    logoUploadInput.addEventListener('change', (e) => handleFileUpload(e, logoPreviewImg, 'logoUrl'));
    faviconUploadInput.addEventListener('change', (e) => handleFileUpload(e, faviconPreviewImg, 'faviconUrl'));
    primaryColorInput.addEventListener('change', updatePreviewColors);
    secondaryColorInput.addEventListener('change', updatePreviewColors);
    portalBannerTextInput.addEventListener('input', updatePreviewColors); // For live text change

    // --- Live Preview Functions ---
    function updatePreviewColors() {
        // Update CSS variables for live preview elements
        previewArea.style.setProperty('--preview-primary-color', primaryColorInput.value);
        previewButton.style.backgroundColor = primaryColorInput.value;
        previewHeader.style.borderColor = primaryColorInput.value; // For border-b

        previewArea.style.setProperty('--preview-secondary-color', secondaryColorInput.value);
        previewCard.style.backgroundColor = secondaryColorInput.value + '20'; // A lighter tint
        previewCard.style.color = secondaryColorInput.value;

        // Update other text/image content directly
        previewBanner.textContent = portalBannerTextInput.value || "Welcome to Your Company's Rental Portal!";
    }

    function updateLivePreview() {
        // Ensure preview elements reflect current state from form inputs
        previewLogo.src = logoPreviewImg.src;
        // Favicon would affect browser tab, not easily previewed within element
        
        primaryColorInput.value = brandingSettings.primaryColor;
        secondaryColorInput.value = brandingSettings.secondaryColor;
        customDomainInput.value = brandingSettings.customDomain;
        domainStatusSpan.textContent = brandingSettings.customDomain ? 'Configured (Needs DNS Verification)' : 'Not Configured';
        senderNameInput.value = brandingSettings.senderName;
        replyToEmailInput.value = brandingSettings.replyToEmail;
        portalBannerTextInput.value = brandingSettings.portalBannerText;
        customCssInput.value = brandingSettings.customCss;
        customJsInput.value = brandingSettings.customJs;

        // Apply colors and text to preview elements
        updatePreviewColors();
    }


    // --- Save & Load Settings ---
    function saveBrandingSettings() {
        brandingSettings.logoUrl = logoPreviewImg.src; // Save current preview as URL
        brandingSettings.faviconUrl = faviconPreviewImg.src;
        brandingSettings.primaryColor = primaryColorInput.value;
        brandingSettings.secondaryColor = secondaryColorInput.value;
        brandingSettings.customDomain = customDomainInput.value;
        brandingSettings.senderName = senderNameInput.value;
        brandingSettings.replyToEmail = replyToEmailInput.value;
        brandingSettings.portalBannerText = portalBannerTextInput.value;
        brandingSettings.customCss = customCssInput.value;
        brandingSettings.customJs = customJsInput.value;

        // For a real app, this data would be sent to a backend API to persist permanently
        // and apply changes across the system/customer portals.
        alert('Branding settings saved successfully! (Note: Changes are client-side only and will reset on page reload.)');
        console.log('Saved Branding Settings:', brandingSettings);
    }

    function loadBrandingSettings() {
        // Load settings into form fields
        logoPreviewImg.src = brandingSettings.logoUrl || 'https://via.placeholder.com/100x40/E0E0E0/6C757D?text=Default+Logo';
        faviconPreviewImg.src = brandingSettings.faviconUrl || 'https://via.placeholder.com/32x32/E0E0E0/6C757D?text=Fav';
        primaryColorInput.value = brandingSettings.primaryColor || '#EA3A26';
        secondaryColorInput.value = brandingSettings.secondaryColor || '#FF8600';
        customDomainInput.value = brandingSettings.customDomain || '';
        domainStatusSpan.textContent = brandingSettings.customDomain ? 'Configured (Needs DNS Verification)' : 'Not Configured';
        senderNameInput.value = brandingSettings.senderName || '';
        replyToEmailInput.value = brandingSettings.replyToEmail || '';
        portalBannerTextInput.value = brandingSettings.portalBannerText || '';
        customCssInput.value = brandingSettings.customCss || '';
        customJsInput.value = brandingSettings.customJs || '';

        updateLivePreview(); // Apply loaded settings to preview
    }


    // --- Initial Render ---
    document.addEventListener('DOMContentLoaded', () => {
        // Attach event listeners for tabs
        brandingTabs.forEach(tab => {
            tab.addEventListener('click', (event) => {
                switchBrandingView(event.target.dataset.tab);
            });
        });

        // Load settings and set initial view to General Branding
        loadBrandingSettings();
        switchBrandingView('general');
    });

    // Ensure initial render on dynamic module load
    if (document.readyState === 'complete' || document.readyState === 'interactive') {
        loadBrandingSettings();
        switchBrandingView('general');
    } else {
        document.addEventListener('DOMContentLoaded', () => {
            loadBrandingSettings();
            switchBrandingView('general');
        });
    }

</script>