<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RentPro - Vendor Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'chili-red': '#EA3A26',
                        'ut-orange': '#FF8600',
                        'chili-red-2': '#EA3D2A',
                        'chili-red-3': '#EA3D24',
                        'tangelo': '#F54F1D',
                        'custom-red': '#FF2424', // Use sparingly, perhaps for alerts
                        'custom-red-2': '#FF0000', // Use sparingly, perhaps for alerts
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-in-out',
                        'slide-up': 'slideUp 0.6s ease-out',
                        'pulse-custom': 'pulse 0.5s ease-in-out',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom animations for consistency */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-backdrop {
            backdrop-filter: blur(4px);
        }
        /* Styles for dynamic tab content in modules (if they use these classes) */
        .tab-button.active, .finance-tab.active, .analytics-tab.active, .settings-tab.active, .dispatch-tab.active, .branding-tab.active {
            border-bottom-color: #EA3A26;
            color: #EA3A26;
        }
        /* Ensure dynamic content uses full height available */
        .module-content-wrapper {
            min-height: calc(100vh - 120px); /* Adjust based on header height, etc. */
            /* This height will ensure charts/tables render correctly without collapsing */
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 font-sans min-h-screen flex flex-col lg:flex-row">

    <button
        id="mobileNavToggle"
        class="lg:hidden fixed top-4 left-4 z-50 bg-chili-red text-white p-3 rounded-lg shadow-lg hover:bg-chili-red-2 transition-colors duration-300"
    >
        <i class="fas fa-bars text-lg"></i>
    </button>

    <div
        id="sidebarOverlay"
        class="lg:hidden fixed inset-0 bg-black bg-opacity-50 z-40 opacity-0 invisible transition-all duration-300"
    ></div>

    <aside
        id="sidebar"
        class="fixed lg:relative bg-gradient-to-b from-black to-gray-800 w-72 h-screen overflow-y-auto z-40 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out"
    >
        <div class="text-center py-8 px-6">
            <h1 class="text-chili-red text-3xl font-bold drop-shadow-lg">
                <i class="fas fa-truck mr-2"></i>RentPro
            </h1>
            <p class="text-gray-400 text-sm">Vendor Dashboard</p>
        </div>

        <nav class="main-nav">
            <ul class="space-y-2 px-4">
                <li><a href="#" data-module="dashboard" class="nav-link active flex items-center px-6 py-4 text-white hover:bg-gradient-to-r hover:from-chili-red hover:to-tangelo hover:transform hover:translate-x-2 transition-all duration-300 rounded-lg border-l-4 border-transparent hover:border-ut-orange"><i class="fas fa-home mr-4 text-lg"></i> Dashboard</a></li>
                <li><a href="#" data-module="booking_scheduling" class="nav-link flex items-center px-6 py-4 text-white hover:bg-gradient-to-r hover:from-chili-red hover:to-tangelo hover:transform hover:translate-x-2 transition-all duration-300 rounded-lg border-l-4 border-transparent hover:border-ut-orange"><i class="fas fa-calendar-alt mr-4 text-lg"></i> Booking & Scheduling</a></li>
                <li><a href="#" data-module="equipment_management" class="nav-link flex items-center px-6 py-4 text-white hover:bg-gradient-to-r hover:from-chili-red hover:to-tangelo hover:transform hover:translate-x-2 transition-all duration-300 rounded-lg border-l-4 border-transparent hover:border-ut-orange"><i class="fas fa-dumpster mr-4 text-lg"></i> Equipment Management</a></li>
                <li><a href="#" data-module="customer_management" class="nav-link flex items-center px-6 py-4 text-white hover:bg-gradient-to-r hover:from-chili-red hover:to-tangelo hover:transform hover:translate-x-2 transition-all duration-300 rounded-lg border-l-4 border-transparent hover:border-ut-orange"><i class="fas fa-users mr-4 text-lg"></i> Customer Management</a></li>
                <li><a href="#" data-module="driver_management" class="nav-link flex items-center px-6 py-4 text-white hover:bg-gradient-to-r hover:from-chili-red hover:to-tangelo hover:transform hover:translate-x-2 transition-all duration-300 rounded-lg border-l-4 border-transparent hover:border-ut-orange"><i class="fas fa-id-card-alt mr-4 text-lg"></i> Driver Management</a></li>
                <li><a href="#" data-module="dispatching" class="nav-link flex items-center px-6 py-4 text-white hover:bg-gradient-to-r hover:from-chili-red hover:to-tangelo hover:transform hover:translate-x-2 transition-all duration-300 rounded-lg border-l-4 border-transparent hover:border-ut-orange"><i class="fas fa-truck-moving mr-4 text-lg"></i> Dispatching</a></li>
                <li><a href="#" data-module="junk_removal" class="nav-link flex items-center px-6 py-4 text-white hover:bg-gradient-to-r hover:from-chili-red hover:to-tangelo hover:transform hover:translate-x-2 transition-all duration-300 rounded-lg border-l-4 border-transparent hover:border-ut-orange"><i class="fas fa-trash-alt mr-4 text-lg"></i> Junk Removal</a></li>
                <li><a href="#" data-module="quotes_invoices_payments" class="nav-link flex items-center px-6 py-4 text-white hover:bg-gradient-to-r hover:from-chili-red hover:to-tangelo hover:transform hover:translate-x-2 transition-all duration-300 rounded-lg border-l-4 border-transparent hover:border-ut-orange"><i class="fas fa-file-invoice-dollar mr-4 text-lg"></i> Quotes & Invoices</a></li>
                <li><a href="#" data-module="financials" class="nav-link flex items-center px-6 py-4 text-white hover:bg-gradient-to-r hover:from-chili-red hover:to-tangelo hover:transform hover:translate-x-2 transition-all duration-300 rounded-lg border-l-4 border-transparent hover:border-ut-orange"><i class="fas fa-chart-line mr-4 text-lg"></i> Financials</a></li>
                <li><a href="#" data-module="analytics" class="nav-link flex items-center px-6 py-4 text-white hover:bg-gradient-to-r hover:from-chili-red hover:to-tangelo hover:transform hover:translate-x-2 transition-all duration-300 rounded-lg border-l-4 border-transparent hover:border-ut-orange"><i class="fas fa-chart-pie mr-4 text-lg"></i> Analytics & Reporting</a></li>
                <li><a href="#" data-module="branding" class="nav-link flex items-center px-6 py-4 text-white hover:bg-gradient-to-r hover:from-chili-red hover:to-tangelo hover:transform hover:translate-x-2 transition-all duration-300 rounded-lg border-l-4 border-transparent hover:border-ut-orange"><i class="fas fa-paint-brush mr-4 text-lg"></i> Rebranding</a></li>
                <li><a href="#" data-module="settings" class="nav-link flex items-center px-6 py-4 text-white hover:bg-gradient-to-r hover:from-chili-red hover:to-tangelo hover:transform hover:translate-x-2 transition-all duration-300 rounded-lg border-l-4 border-transparent hover:border-ut-orange"><i class="fas fa-cog mr-4 text-lg"></i> Settings</a></li>
            </ul>
        </nav>
        <div class="sidebar-footer mt-auto py-4 text-center text-gray-500 text-xs">
            <p>&copy; 2025 RentPro</p>
        </div>
    </aside>

    <main class="flex-1 flex flex-col">
        <header class="bg-white p-4 lg:p-6 shadow-md flex justify-between items-center z-30">
            <div class="search-bar flex items-center bg-gray-100 rounded-full px-4 py-2 w-full max-w-sm">
                <i class="fas fa-search text-gray-400 mr-2"></i>
                <input type="text" placeholder="Search here..." class="bg-transparent outline-none text-gray-700 w-full">
            </div>
            <div class="user-profile flex items-center ml-4">
                <span class="font-semibold text-gray-800 hidden md:block">Ahmad Khan</span>
                <span class="text-gray-500 text-sm mx-2 hidden md:block">Super Admin</span>
                <div class="w-10 h-10 rounded-full bg-chili-red text-white flex items-center justify-center font-bold text-base ml-2">AK</div>
            </div>
        </header>
        <div id="module-container" class="module-content-wrapper flex-1 p-4 lg:p-8 overflow-y-auto">
            </div>
    </main>

    <div id="notificationContainer" class="fixed top-4 right-4 z-50"></div>

    <script>
        // Global data stores (ensure they are arrays)
        // These are intentionally declared in the global scope (window object)
        // so that all dynamically loaded modules can access and modify them.
        // They are initialized with dummy data ONLY ONCE.
        window.customerData = window.customerData || [];
        window.equipmentData = window.equipmentData || [];
        window.bookingData = window.bookingData || [];
        window.quotesData = window.quotesData || [];
        window.invoicesData = window.invoicesData || [];
        window.paymentsData = window.paymentsData || [];
        window.driverData = window.driverData || [];
        window.junkRemovalData = window.junkRemovalData || [];
        window.expenseData = window.expenseData || [];
        window.vendorSettings = window.vendorSettings || {};
        window.internalUsersData = window.internalUsersData || [];
        window.dummyDataInitialized = false; // Flag to prevent re-initialization

        function initializeDummyData() {
            if (window.dummyDataInitialized) {
                console.log("Dummy data already initialized.");
                return; // Prevent re-initialization if already done
            }

            console.log("Initializing global dummy data...");

            // Customer Data
            window.customerData = [
                { id: 'CUST001', name: 'Alice Smith', company: 'ABC Construction', email: 'alice.smith@example.com', phone: '(555) 123-4567', billingAddress: '123 Main St, Springfield, IL 62701', serviceAddresses: '123 Main St, Springfield, IL 62701; 456 Elm St, Springfield, IL 62704', customerType: 'Commercial', status: 'Active', internalNotes: 'Prefers email communication. Always pays on time.' },
                { id: 'CUST002', name: 'Bob Johnson', company: '', email: 'bob.j@example.com', phone: '(555) 987-6543', billingAddress: '789 Oak Ave, Lincoln, NE 68501', serviceAddresses: '789 Oak Ave, Lincoln, NE 68501', customerType: 'Residential', status: 'Active', internalNotes: 'First-time renter. Needs clear instructions for dumpster use.' },
                { id: 'CUST003', name: 'Charlie Brown', company: 'Brown Events', email: 'charlie.b@events.com', phone: '(555) 234-5678', billingAddress: '101 Event Plaza, New York, NY 10001', serviceAddresses: '101 Event Plaza, New York, NY 10001; 202 Convention Ctr, New York, NY 10002', customerType: 'Commercial', status: 'On Hold', internalNotes: 'Large events client. Currently on hold due to pending contract renewal.' },
                { id: 'CUST004', name: 'Diana Prince', company: 'Wonder Corp', email: 'diana.p@wonder.com', phone: '(555) 345-6789', billingAddress: '321 Justice Way, Washington, DC 20001', serviceAddresses: '321 Justice Way, Washington, DC 20001', customerType: 'Commercial', status: 'Active', internalNotes: 'VIP client. Requires immediate attention for all requests.' }
            ];

            // Equipment Data
            window.equipmentData = [
                { id: 'EQ001', type: 'Dumpster', size: '20-yard', status: 'Available', location: 'Yard A', description: 'Standard 20-yard dumpster, good condition.', purchaseDate: '2022-01-15', purchaseCost: 3500.00, supplierManufacturer: 'Waste Solutions Inc.', dumpsterDimensions: '20x8x5 ft', maxTonnage: 3, dumpsterContainerType: 'Roll-off', gateType: 'Walk-in Door', prohibitedMaterials: 'Tires, Batteries', baseDailyRate: 150.00, defaultRentalPeriod: 7, minRentalPeriod: 1, extendedDailyRate: 15.00, deliveryFee: 75.00, pickupFee: 75.00, overagePerTonFee: 75.00, disposalRatePerTon: 50.00, damageWaiverCost: 25.00 },
                { id: 'EQ002', type: 'Temporary Toilet', size: 'Standard', status: 'On Rent', location: 'Job Site Alpha', description: 'Basic portable toilet, serviced weekly.', purchaseDate: '2023-03-01', purchaseCost: 800.00, supplierManufacturer: 'Porta-Loo Co.', toiletCapacity: '60 Gallons', serviceFrequency: 'Weekly', toiletFeatures: 'Urinal, Toilet Paper Dispenser', baseDailyRate: 25.00, defaultRentalPeriod: 28, minRentalPeriod: 7, extendedDailyRate: 5.00, deliveryFee: 50.00, pickupFee: 50.00, overagePerTonFee: 0, disposalRatePerTon: 0, damageWaiverCost: 10.00 },
                { id: 'EQ003', type: 'Storage Container', size: '40ft', status: 'In Maintenance', location: 'Repair Shop', description: 'Needs door repair.', purchaseDate: '2021-06-20', purchaseCost: 6000.00, supplierManufacturer: 'Container Solutions', storageContainerType: 'Standard', doorType: 'Swing-out', condition: 'As-Is', securityFeatures: 'Lockbox', baseDailyRate: 90.00, defaultRentalPeriod: 30, minRentalPeriod: 14, extendedDailyRate: 20.00, deliveryFee: 100.00, pickupFee: 100.00, overagePerTonFee: 0, disposalRatePerTon: 0, damageWaiverCost: 30.00 },
                { id: 'EQ004', type: 'Dumpster', size: '30-yard', status: 'Available', location: 'Yard B', description: 'Larger capacity dumpster, heavy duty.', purchaseDate: '2023-09-10', purchaseCost: 4500.00, supplierManufacturer: 'MegaBins Inc.', dumpsterDimensions: '22x8x6 ft', maxTonnage: 5, dumpsterContainerType: 'Roll-off', gateType: 'No Door', prohibitedMaterials: 'Asbestos, Chemicals', baseDailyRate: 200.00, defaultRentalPeriod: 10, minRentalPeriod: 3, extendedDailyRate: 20.00, deliveryFee: 100.00, pickupFee: 100.00, overagePerTonFee: 85.00, disposalRatePerTon: 60.00, damageWaiverCost: 35.00 },
                { id: 'EQ005', type: 'Temporary Toilet', size: 'ADA Compliant', status: 'Available', location: 'Yard A', description: 'ADA compliant unit with handrails.', purchaseDate: '2024-01-05', purchaseCost: 1200.00, supplierManufacturer: 'Accessible Loos', toiletCapacity: '80 Gallons', serviceFrequency: 'Weekly', toiletFeatures: 'Handrails, Wider Door, Interior Light', baseDailyRate: 35.00, defaultRentalPeriod: 28, minRentalPeriod: 7, extendedDailyRate: 7.00, deliveryFee: 60.00, pickupFee: 60.00, overagePerTonFee: 0, disposalRatePerTon: 0, damageWaiverCost: 15.00 },
                { id: 'EQ006', type: 'Storage Container', size: '20ft', status: 'On Rent', location: 'Customer Warehouse', description: 'Secure storage for tools and equipment.', purchaseDate: '2022-11-01', purchaseCost: 4000.00, supplierManufacturer: 'Secure Storage Units', storageContainerType: 'Standard', doorType: 'Roll-up', condition: 'Wind & Watertight', securityFeatures: 'Reinforced Doors', baseDailyRate: 60.00, defaultRentalPeriod: 30, minRentalPeriod: 7, extendedDailyRate: 12.00, deliveryFee: 80.00, pickupFee: 80.00, overagePerTonFee: 0, disposalRatePerTon: 0, damageWaiverCost: 20.00 },
                { id: 'EQ007', type: 'Dumpster', size: '10-yard', status: 'Reserved', location: 'Yard A', description: 'Small dumpster for residential cleanouts.', purchaseDate: '2023-05-20', purchaseCost: 2500.00, supplierManufacturer: 'EcoBins', dumpsterDimensions: '12x8x3.5 ft', maxTonnage: 1.5, dumpsterContainerType: 'Roll-off', gateType: 'Walk-in Door', prohibitedMaterials: 'Paint, Oils', baseDailyRate: 100.00, defaultRentalPeriod: 5, minRentalPeriod: 1, extendedDailyRate: 10.00, deliveryFee: 60.00, pickupFee: 60.00, overagePerTonFee: 60.00, disposalRatePerTon: 40.00, damageWaiverCost: 15.00 }
            ];

            // Booking Data
            window.bookingData = [
                { id: 'BOOK001', customerId: 'CUST001', equipmentId: 'EQ001', rentalStartDate: '2025-07-25', rentalEndDate: '2025-07-30', deliveryAddress: '123 Main St, Springfield, IL', pickupAddress: '123 Main St, Springfield, IL', status: 'Confirmed', totalPrice: 750.00, bookingNotes: 'Customer prefers early morning delivery.', estimatedTonnage: 2.5, prohibitedMaterialsAck: '', driverId: 'DRV001' },
                { id: 'BOOK002', customerId: 'CUST002', equipmentId: 'EQ002', rentalStartDate: '2025-08-01', rentalEndDate: '2025-08-29', deliveryAddress: '789 Oak Ave, Lincoln, NE', pickupAddress: '789 Oak Ave, Lincoln, NE', status: 'Pending', totalPrice: 100.00, bookingNotes: 'New residential client, confirm access before delivery.', requestedServiceFreq: 'Weekly', toiletSpecialRequests: 'Place behind garage.', driverId: '' },
                { id: 'BOOK003', customerId: 'CUST001', equipmentId: 'EQ003', rentalStartDate: '2025-07-20', rentalEndDate: '2025-08-20', deliveryAddress: '456 Elm St, Springfield, IL', pickupAddress: '456 Elm St, Springfield, IL', status: 'Delivered', totalPrice: 2700.00, bookingNotes: 'Long-term storage container for new project.', containerPlacementNotes: 'Needs to be on concrete slab, path is narrow.', containerSecurityAccess: 'Gate code: 7890, call 1hr prior.', driverId: 'DRV002' }
            ];

            // Quotes Data
            window.quotesData = [
                { id: 'QUO001', customerId: 'CUST001', quoteDate: '2025-07-15', items: [{ equipmentId: 'EQ001', rentalDays: 5, unitPrice: 150.00, itemTotalPrice: 750.00 }], deliveryFee: 75.00, pickupFee: 75.00, damageWaiver: 25.00, totalAmount: 850.00, notes: 'Special discount applied for long-term customer.', status: 'Sent' },
                { id: 'QUO002', customerId: 'CUST002', quoteDate: '2025-07-20', items: [{ equipmentId: 'EQ002', rentalDays: 28, unitPrice: 25.00, itemTotalPrice: 700.00 }], deliveryFee: 50.00, pickupFee: 50.00, damageWaiver: 10.00, totalAmount: 810.00, notes: '', status: 'Draft' }
            ];

            // Invoices Data
            window.invoicesData = [
                { id: 'INV001', customerId: 'CUST001', issueDate: '2025-07-01', dueDate: '2025-07-31', items: [{ description: '20-yard Dumpster Rental (Jul 1-15)', amount: 150.00 * 15, unitPrice: 150.00, quantity: 15 }], totalAmount: 2325.00, balanceDue: 0.00, status: 'Paid', linkedQuoteId: 'QUO001' },
                { id: 'INV002', customerId: 'CUST002', issueDate: '2025-07-10', dueDate: '2025-08-09', items: [{ description: 'Standard Toilet Rental (Jul 10-Aug 9)', amount: 25.00 * 31, unitPrice: 25.00, quantity: 31 }, { description: 'Delivery Fee', amount: 50.00, unitPrice: 50.00, quantity: 1 }, { description: 'Damage Waiver', amount: 10.00, unitPrice: 10.00, quantity: 1 }], totalAmount: 835.00, balanceDue: 835.00, status: 'Sent', linkedBookingId: 'BOOK002' },
                { id: 'INV003', customerId: 'CUST001', totalAmount: 700, balanceDue: 700, status: 'Overdue', issueDate: '2025-06-01', dueDate: '2025-07-01', items: [{ description: 'Overdue Rental Fee', amount: 700, unitPrice: 700, quantity: 1 }] }
            ];

            // Payments Data
            window.paymentsData = [
                { id: 'PAY001', invoiceId: 'INV001', customerId: 'CUST001', paymentDate: '2025-07-25', amount: 2325.00, method: 'Credit Card', notes: 'Full payment received.' }
            ];

            // Driver Data
            window.driverData = [
                { id: 'DRV001', name: 'Michael Scott', email: 'michael.s@example.com', phone: '(111) 222-3333', licenseNumber: 'MS123456', licenseExpiry: '2026-12-31', cdlClass: 'Class A', status: 'Active', assignedVehicle: 'Truck 101', driverNotes: 'Excellent performance, very reliable.' },
                { id: 'DRV002', name: 'Dwight Schrute', email: 'dwight.s@example.com', phone: '(222) 333-4444', licenseNumber: 'DS987654', licenseExpiry: '2025-06-15', cdlClass: 'Class B', status: 'Active', assignedVehicle: 'Truck 102', driverNotes: 'Always follows protocols, sometimes too literal.' },
                { id: 'DRV003', name: 'Pam Beesly', email: 'pam.b@example.com', phone: '(333) 444-5555', licenseNumber: 'PB010101', licenseExpiry: '2027-01-01', cdlClass: 'Class C', status: 'On Leave', assignedVehicle: 'None', driverNotes: 'On maternity leave until next quarter.' }
            ];

            // Junk Removal Data
            window.junkRemovalData = [
                { id: 'JR001', customerId: 'CUST001', requestedDate: '2025-07-28', requestedTime: '10:00', jobLocation: '123 Main St, Anytown', descriptionOfJunk: 'Old sofa, broken washing machine, general household junk.', volumeEstimate: '2 cu yards', weightEstimate: '500 lbs', crewRequirements: 2, assignedDriver: 'DRV001', estimatedPrice: 350.00, status: 'Scheduled', jobNotes: 'Customer requested call 30 mins prior to arrival.' },
                { id: 'JR002', customerId: 'CUST001', requestedDate: '2025-07-29', requestedTime: '', jobLocation: '456 Oak Ave, Otherville', descriptionOfJunk: 'Construction debris: wood, drywall scraps.', volumeEstimate: '5 cu yards', weightEstimate: '1 ton', crewRequirements: 3, assignedDriver: '', estimatedPrice: 600.00, status: 'Quoted', jobNotes: 'Quote sent for approval.' }
            ];

            // Expense Data
            window.expenseData = [
                { id: 'EXP001', date: '2025-07-10', description: 'Diesel Refill - Truck 101', category: 'Fuel', amount: 120.50, notes: 'Full tank' },
                { id: 'EXP002', date: '2025-07-12', description: 'Office Paper & Pens', category: 'Office Supplies', amount: 45.75, notes: '' },
                { id: 'EXP003', date: '2025-07-15', description: 'Dumpster EQ001 Repair', category: 'Maintenance', amount: 300.00, notes: 'Gate hinge replacement' },
                { id: 'EXP004', date: '2025-07-20', description: 'Digital Ad Campaign', category: 'Marketing', amount: 500.00, notes: 'Google Ads for July' }
            ];

            // Vendor Settings (for Settings and Branding modules)
            window.vendorSettings = {
                businessName: 'Your Company Rentals Inc.',
                contactEmail: 'info@yourcompany.com',
                contactPhone: '(123) 456-7890',
                primaryAddress: '123 Corporate Blvd, Anytown, CA 90210',
                operatingHours: 'Mon-Fri: 8AM-5PM, Sat: 9AM-1PM',
                serviceAreas: '90210, 90211, Anytown, Othercity',
                notifyNewBooking: true,
                notifyPaymentReceived: true,
                notifyOverdueInvoice: true,
                notifyDriverIssues: false,
                smsApiKey: 'sk_demo_123abc',
                chatCode: '// Dummy chat widget script: console.log("Chat widget loaded.");',
                logoUrl: 'https://via.placeholder.com/100x40/EA3A26/FFFFFF?text=RentPro+Logo', // Default for Branding module
                faviconUrl: 'https://via.placeholder.com/32x32/EA3A26/FFFFFF?text=Fav', // Default for Branding module
                primaryColor: '#EA3A26', // Default for Branding module
                secondaryColor: '#FF8600', // Default for Branding module
                customDomain: '',
                senderName: '',
                replyToEmail: '',
                portalBannerText: '',
                customCss: '',
                customJs: ''
            };

            // Internal Users Data (for Settings module)
            window.internalUsersData = [
                { id: 'STAFF001', name: 'Vendor Admin', email: 'admin@yourcompany.com', role: 'Admin', status: 'Active' },
                { id: 'STAFF002', name: 'Dispatcher One', email: 'dispatch@yourcompany.com', role: 'Dispatcher', status: 'Active' },
                { id: 'STAFF003', name: 'Sales Manager', email: 'sales@yourcompany.com', role: 'Sales', status: 'Active' },
                { id: 'STAFF004', name: 'Inactive User', email: 'inactive@yourcompany.com', role: 'Viewer', status: 'Inactive' }
            ];
            window.dummyDataInitialized = true; // Set flag to true after initialization
        }


        // Global Notification System (reused across all modules for consistency)
        // This function resides in the main index.html to be globally accessible.
        function showNotification(message, type = 'info') {
            const notificationContainer = document.getElementById('notificationContainer');
            if (!notificationContainer) {
                console.warn("Notification container not found. Cannot display notification.");
                return;
            }
            const notification = document.createElement('div');
            notification.className = `p-4 rounded-lg shadow-lg max-w-sm mt-2 transition-all duration-300 transform translate-x-full opacity-0`;

            const colors = {
                success: 'bg-green-500 text-white',
                error: 'bg-red-500 text-white',
                info: 'bg-blue-500 text-white',
                warning: 'bg-yellow-500 text-white'
            };

            notification.className += ` ${colors[type]}`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <span class="flex-1">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;

            notificationContainer.appendChild(notification);

            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full', 'opacity-0');
                notification.classList.add('translate-x-0', 'opacity-100');
            }, 50);

            // Animate out and remove after a delay
            setTimeout(() => {
                notification.classList.remove('translate-x-0', 'opacity-100');
                notification.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // --- Main Dashboard Layout Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeDummyData(); // Initialize global dummy data ONCE on main page load

            const moduleContainer = document.getElementById('module-container');
            const navLinks = document.querySelectorAll('.main-nav a');
            const mobileNavToggle = document.getElementById('mobileNavToggle');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');

            // Function to set active class for navigation links
            function setActiveLink(clickedLink) {
                navLinks.forEach(link => link.classList.remove('active', 'bg-gradient-to-r', 'from-chili-red', 'to-tangelo', 'border-ut-orange', 'transform', 'translate-x-2'));
                clickedLink.classList.add('active', 'bg-gradient-to-r', 'from-chili-red', 'to-tangelo', 'border-ut-orange', 'transform', 'translate-x-2');
            }

            // Event listener for sidebar navigation clicks
            navLinks.forEach(link => {
                link.addEventListener('click', (event) => {
                    event.preventDefault();
                    const moduleName = event.target.closest('a').dataset.module;
                    if (moduleName) {
                        setActiveLink(event.target.closest('a'));
                        loadModule(moduleName);
                        if (window.innerWidth < 1024) { // Close sidebar on mobile after click
                            toggleMobileNav();
                        }
                    }
                });
            });

            // Function to load external HTML modules
            function loadModule(moduleName) {
                console.log(`Attempting to load module: ${moduleName}`);
                let filePath = `${moduleName}.html`; // Assuming file names match data-module attributes

                fetch(filePath)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok ' + response.statusText);
                        }
                        return response.text();
                    })
                    .then(html => {
                        console.log(`Module HTML for ${moduleName} fetched successfully.`);
                        // Clear existing content and scripts
                        moduleContainer.innerHTML = '';

                        // Create a temporary div to parse the HTML and extract scripts
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = html;

                        // Append HTML content (excluding scripts for now)
                        const contentNodes = Array.from(tempDiv.children).filter(node => node.tagName !== 'SCRIPT');
                        contentNodes.forEach(node => moduleContainer.appendChild(node));

                        // Re-execute scripts embedded in the loaded HTML
                        // This pattern is crucial for dynamic modules
                        const scriptsToExecute = tempDiv.querySelectorAll('script');
                        scriptsToExecute.forEach(oldScript => {
                            const newScript = document.createElement('script');
                            Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));

                            if (oldScript.textContent) {
                                newScript.textContent = oldScript.textContent;
                            } else if (oldScript.src) { // For external scripts like SignaturePad or FullCalendar
                                newScript.src = oldScript.src;
                            }

                            // Append script to a place where it will be parsed and executed
                            // Head is often better for external scripts, body for inline.
                            document.head.appendChild(newScript);
                            // To prevent "already declared" errors for variables within modules,
                            // we must ensure module scripts ONLY reference global variables (window.myVar)
                            // or declare their own variables within block scopes to avoid global conflicts.
                            // The 'let VAR = window.VAR;' pattern inside modules will now work.
                            // However, any `var` declarations or top-level `let/const` in global scope
                            // within module scripts will still cause issues on re-execution.
                            // The current solution relies on changing module scripts to use `const myVar = window.myVar;`
                            // and putting their own functions/vars inside their scope.
                        });

                        // Specific re-initialization calls for modules that need it after DOM content is loaded
                        // e.g., Chart.js charts, FullCalendar instances, initial table rendering
                        if (moduleName === 'dashboard' && typeof renderCharts === 'function') {
                            renderCharts(); // Re-render charts
                        }
                        if (moduleName === 'analytics' && typeof renderAnalyticsCharts === 'function') {
                            renderAnalyticsCharts(); // Re-render analytics charts
                        }
                        // For modules with table/modal logic, they often have a DOMContentLoaded listener
                        // that handles their initial rendering. This might need to be explicitly called
                        // if their own `DOMContentLoaded` event doesn't fire when injected.
                        // We will rely on their internal scripts to call their render functions
                        // which should be outside their `DOMContentLoaded` or called manually if needed.
                        // Example: if (typeof renderCustomersTable === 'function') renderCustomersTable();

                    })
                    .catch(error => {
                        console.error(`Error loading module ${moduleName}:`, error);
                        moduleContainer.innerHTML = `
                            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative p-8">
                                <h2 class="text-2xl font-bold mb-4">Error Loading Module</h2>
                                <p>Failed to load the "${moduleName.replace(/_/g, ' ').replace(/\b\w/g, char => char.toUpperCase())}" module.</p>
                                <p>Please ensure the file "${filePath}" exists in the same directory and there are no network issues.</p>
                                <p class="mt-2 text-sm italic">Error details: ${error.message}</p>
                            </div>
                        `;
                        showNotification(`Failed to load ${moduleName} module.`, 'error');
                    });
            }

            // --- Mobile Navigation Functionality ---
            function toggleMobileNav() {
                sidebar.classList.toggle('translate-x-0');
                sidebar.classList.toggle('-translate-x-full');
                sidebarOverlay.classList.toggle('opacity-0');
                sidebarOverlay.classList.toggle('invisible');
                sidebarOverlay.classList.toggle('opacity-100');
                sidebarOverlay.classList.toggle('visible');

                const icon = mobileNavToggle.querySelector('i');
                if (sidebar.classList.contains('translate-x-0')) {
                    icon.className = 'fas fa-times text-lg';
                } else {
                    icon.className = 'fas fa-bars text-lg';
                }
            }

            mobileNavToggle.addEventListener('click', toggleMobileNav);
            sidebarOverlay.addEventListener('click', toggleMobileNav); // Click overlay to close

            // Handle window resize to ensure sidebar is visible on large screens
            window.addEventListener('resize', () => {
                if (window.innerWidth >= 1024) {
                    sidebar.classList.remove('-translate-x-full');
                    sidebar.classList.add('translate-x-0');
                    sidebarOverlay.classList.add('opacity-0', 'invisible');
                    sidebarOverlay.classList.remove('opacity-100', 'visible');
                    mobileNavToggle.querySelector('i').className = 'fas fa-bars text-lg';
                }
            });

            // Load dashboard module by default on page load
            loadModule('dashboard');
        });
    </script>
</body>
</html>